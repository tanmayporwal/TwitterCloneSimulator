<!DOCTYPE html>
<html lang="en">
<head>
    <title>twitter home</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <style>
        .contain {
            margin-right: 7%;
            margin-left: 7%;
        }
    </style>
</head>

<body>
    <script language="javascript" type="text/javascript">
        var username = localStorage.getItem("user")
        var first = true
        var wsUri = "ws://localhost:8080/websocket";
        var output;
        websocket = new WebSocket(wsUri);

        function init() {
            output = document.getElementById("output");
            output1 = document.getElementById("output1");
            output2 = document.getElementById("output2");
            output3 = document.getElementById("output3");
            testWebSocket();
        }

        function testWebSocket() {
            websocket.onopen = function (evt) { onOpen(evt) };
            websocket.onclose = function (evt) { onClose(evt) };
            websocket.onmessage = function (evt) { onMessage(evt) };
            websocket.onerror = function (evt) { onError(evt) };
        }

        function onOpen(evt) {
            
        }

        function onClose(evt) {
        }

        function onMessage(evt) {
            console.log(evt.data)
            if (evt.data.includes("hi4xyz")) {
                var result = evt.data.split('&')
                var tid = result[1].split(':')[1]
                var tweet = result[2].split(':')[1]
                var cid = result[3].split(':')[1]
                var isr = result[4].split(':')[1]
                var rtid = result[5].split(':')[1]
                var sid = result[6].split(':')[1]

                function click2() {
                    var msg = "type:RTWT&un:" + username + "&tid:" + tid
                    websocket.send(msg)
                }
                var card = document.createElement("div");
                card.className = "card"
                card.style = "width: 18rem;"
                var card2 = document.createElement("div");
                card2.className = "card-body"
                var he1 = document.createElement("h5");
                he1.className = "card-title"
                he1.innerHTML =  cid
                card2.appendChild(he1)

                if (isr.includes("T")) {
                    var he2 = document.createElement("h6");
                    he2.className = "card-subtitle mb-2 text-muted"
                    he2.innerHTML = "Retweeted By " + sid
                    card2.appendChild(he2)
                }
                var he3 = document.createElement("p");
                he3.className = "card-text"
                he3.style.wordWrap = "break-word";
                he3.innerHTML = tweet;
                card2.appendChild(he3)
                var he4 = document.createElement("button");
                he4.className = "btn btn-basic"
                he4.innerHTML = "Retweet"
                he4.onclick = click2
                card2.appendChild(he4);
                card.appendChild(card2);
                output.prepend(card)

            }

            if (evt.data.includes("htxyz")) {
                var result = evt.data.split('&')
                var tid = result[1].split(':')[1]
                var tweet = result[2].split(':')[1]
                var cid = result[3].split(':')[1]
                var isr = result[4].split(':')[1]
                var rtid = result[5].split(':')[1]
                var sid = result[6].split(':')[1]

                function click2() {
                    var msg = "type:RTWT&un:" + username + "&tid:" + tid
                    websocket.send(msg)
                }
                var card = document.createElement("div");
                card.className = "card"
                card.style = "width: 18rem;"
                var card2 = document.createElement("div");
                card2.className = "card-body"
                var he1 = document.createElement("h5");
                he1.className = "card-title"
                he1.innerHTML = cid
                card2.appendChild(he1)

                if (isr.includes("T")) {
                    var he2 = document.createElement("h6");
                    he2.className = "card-subtitle mb-2 text-muted"
                    he2.innerHTML = "Retweeted By " + sid
                    card2.appendChild(he2)
                }
                var he3 = document.createElement("p");
                he3.className = "card-text"
                he3.style.wordWrap = "break-word";
                he3.innerHTML = tweet;
                card2.appendChild(he3)
                var he4 = document.createElement("button");
                he4.className = "btn btn-basic"
                he4.innerHTML = "Retweet"
                he4.onclick = click2
                card2.appendChild(he4);
                card.appendChild(card2);
                output.prepend(card)

            }

            if (evt.data.includes("sxyz")) {
                var result = evt.data.split('&')
                var tid = result[1].split(':')[1]
                var tweet = result[2].split(':')[1]
                var cid = result[3].split(':')[1]
                var isr = result[4].split(':')[1]
                var rtid = result[5].split(':')[1]
                var sid = result[6].split(':')[1]

                function click2() {
                    var msg = "type:RTWT&un:" + username + "&tid:" + tid
                    websocket.send(msg)
                }
                var card = document.createElement("div");
                card.className = "card"
                card.style = "width: 18rem;"
                var card2 = document.createElement("div");
                card2.className = "card-body"
                var he1 = document.createElement("h5");
                he1.className = "card-title"
                he1.innerHTML = cid
                card2.appendChild(he1)

                if (isr.includes("T")) {
                    var he2 = document.createElement("h6");
                    he2.className = "card-subtitle mb-2 text-muted"
                    he2.innerHTML = "Retweeted By " + sid
                    card2.appendChild(he2)
                }
                var he3 = document.createElement("p");
                he3.className = "card-text"
                he3.style.wordWrap = "break-word";
                he3.innerHTML = tweet;
                card2.appendChild(he3)
                var he4 = document.createElement("button");
                he4.className = "btn btn-basic"
                he4.innerHTML = "Retweet"
                he4.onclick = click2
                card2.appendChild(he4);
                card.appendChild(card2);
                output1.prepend(card)

            }

            if (evt.data.includes("dfl")) {
                var result = evt.data.split('&')
                var uid = result[1].split(':')[1]
                var card = document.createElement("div");
                card.className = "card border rounded-lg"
                var card2 = document.createElement("div");
                card2.className = "card-body"
                card2.innerHTML = "User" + uid
                card.appendChild(card2)
                output2.prepend(card)
            }

            if (evt.data.includes("dofl")) {
                var result = evt.data.split('&')
                var uid = result[1].split(':')[1]
                var card = document.createElement("div");
                card.className = "card border rounded-lg"
                var card2 = document.createElement("div");
                card2.className = "card-body"
                card2.innerHTML = "User" + uid
                card.appendChild(card2)
                output3.prepend(card)
            }
        }

            function onError(evt) {
                writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.data);
            }

            function doSend(message) {
            }

            
            function writeToScreen(message) {
                var pre = document.createElement("p");
                pre.style.wordWrap = "break-word";
                pre.innerHTML = message;
                output.appendChild(pre);
            }

        function callmefirst() {
            
            if (first) {
                websocket.send("HOME&user:" + username)
            }
            first = false
        }

        function tweetfunc() {
            var tweet = document.getElementById("tweettextarea").value
            var msg = "type:TWEET&un:" + username + "&text:" + tweet
            websocket.send(msg)
            document.getElementById("tweettextarea").value = ""
        }

        function searchfunc() {
            var search = document.getElementById("searchtext").value
            var msg = "type:SEARCH&un:" + username + "&text:" + search
            output1.innerHTML = ""
            websocket.send(msg)
            document.getElementById("searchtext").value = ""
        }

        function followfunc() {
            var follow = document.getElementById("followinguser").value
            var msg = "type:FOLLOWXYZ&un:" + username + "&text:" + follow
            
            websocket.send(msg)
        }
        function logout() {
            var msg = "type:LOGOUT&un:" + username
            websocket.send(msg)
            alert("Logout Succesful!")
            window.location.replace("http://127.0.0.1:8080/login")
        }

            window.addEventListener("load", init, false);



    </script>

    <div class="contain">

        <h2 class="text-center">Twitter Clone</h2>
        <button onClick="logout()" type="button" class=" p-2 mb-2 btn btn-primary pull-right" id="submittweet">Logout</button>


        <ul class="nav nav-tabs">
            <li class="active"><button onClick="callmefirst()" type="button" class="btn btn-link" data-toggle="tab" href="#home">Home</button></li>
            <li><button type="button" class="btn btn-link" data-toggle="tab" href="#search">Search</button></li>
            <li><button type="button" class="btn btn-link" data-toggle="tab" href="#fl">Followers</button></li>
            <li><button type="button" class="btn btn-link" data-toggle="tab" href="#fol">Following</button></li>
        </ul>

        <div class="tab-content">
            <div id="home" class="tab-pane fade in active">
                <h3>HOME</h3>
                <div class="form-group">
                    <label for="tweet">Enter your tweet here:</label>
                    <textarea class="form-control" rows="5" id="tweettextarea"></textarea>
                    <br>
                    <button onClick="tweetfunc()" type="button" class=" p-2 btn btn-primary " id="submittweet">Tweet</button>
                </div>
                <div id="output">

                </div>
            </div>


            <div id="search" class="tab-pane fade">
                <h3>Search</h3>
                <div class="form-group">
                    <label for="searchtext">Search here:</label>
                    <input type="text" class="form-control" id="searchtext"></input>
                    <br>
                    <button onClick="searchfunc()" type="button" class=" p-2 btn btn-primary " id="submitsearch">Search</button>
                </div>
                <div id="output1">

                </div>
            </div>
            <div id="fl" class="tab-pane fade mb-2">
                <h3>Followers List</h3>
                <input class="form-control lg" type="text" placeholder="My Followers." readonly>
                <div id="output2">

                </div>
            </div>
            <div id="fol" class="tab-pane fade">
                <br>
                <label for="followinguser">Search User here:</label>
                <input type="text" class="form-control" id="followinguser"></input>
                <br>
                <button onClick="followfunc()" type="button" class=" p-2 btn btn-primary " id="submitfollowreq">Follow</button>
                <h3>Following List</h3>
                <input class="form-control lg" type="text" placeholder="My Followings." readonly>
                <div id="output3">

                </div>
            </div>
        </div>
    </div>

</body>
</html>
